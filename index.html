<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DropNFT — Máquina NFT</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<meta name="color-scheme" content="light dark" />
</head>
<body class="min-h-screen flex flex-col bg-gray-50 text-gray-900">

<!-- Banner -->
<div id="banner" class="hidden px-4 py-3 text-white text-sm font-medium" aria-live="polite"></div>

<!-- Header -->
<header class="px-4 md:px-8 py-5 border-b bg-white">
    <div class="max-w-7xl mx-auto flex items-center justify-between gap-4">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-purple-600 flex items-center justify-center text-white font-bold">DN</div>
            <div>
                <h1 class="text-xl md:text-2xl font-extrabold tracking-tight">DropNFT</h1>
                <p class="text-xs text-gray-500 -mt-0.5">Máquina NFT para tus obras de arte</p>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button id="btnVender" class="bg-gray-900 hover:bg-black text-white px-4 py-2 rounded-lg shadow transition">
                Vender
            </button>
            <button id="btnConnect" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg shadow transition">
                Conectar wallet
            </button>
        </div>
    </div>
</header>

<main class="flex-grow px-4 md:px-8 py-8">
    <div class="max-w-3xl mx-auto space-y-8">

        <!-- Card principal -->
        <section id="sectionPrincipal" class="bg-gradient-to-r from-purple-50 to-white border border-purple-100 shadow-sm rounded-2xl p-6 md:p-10 space-y-6">
            <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 leading-tight">
                Conectá tu wallet. Vende tu obra. Vendé en segundos.
            </h2>
            <p class="text-gray-600 mb-4">
                Convertí tu arte en un NFT único y ponelo a la venta en segundos. Comprá y sé dueño de piezas digitales exclusivas que nadie más tendrá.
            </p>

            <!-- Imagen destacada -->
            <div class="w-full h-64 md:h-96 rounded-xl border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden relative">
                <div id="featuredWrap" class="w-full h-full flex items-center justify-center">
                    <span class="text-sm text-gray-400">Sin imágenes</span>
                </div>
            </div>

            <!-- Botón Comprar -->
            <div class="flex flex-col items-center">
                <button id="btnComprar" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg shadow mb-2">
                    Comprar pixel
                </button>
                <span class="text-xs text-gray-500">Siguientes obras en la cola:</span>
            </div>

            <!-- Miniaturas de la cola -->
            <div class="flex flex-wrap gap-2 justify-center" id="listaCola"></div>
        </section>

        <!-- Sección Cargar imagen -->
        <section id="sectionCargar" class="bg-white shadow rounded-2xl p-6 space-y-6 hidden">
            <h2 class="text-2xl font-semibold">Vender obra</h2>
            <div>
                <label class="block text-sm font-medium mb-1">Archivo</label>
                <input id="fileInput" type="file" accept="image/jpeg" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100" />
                <p class="text-xs text-gray-500 mt-2">JPG hasta 1000×1000 píxeles.</p>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Precio de publicación (ETH)</label>
                <input type="number" value="1" class="w-full border rounded-lg px-3 py-2" disabled />
                <p class="text-xs text-gray-500 mt-2">Precio fijo para publicar la obra.</p>
            </div>
            <button id="btnPublicar" class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2.5 rounded-lg shadow">Publicar</button>
        </section>

    </div>
</main>

<footer class="px-4 md:px-8 py-6 border-t bg-white mt-auto">
    <div class="max-w-7xl mx-auto text-xs text-gray-500 flex items-center justify-between">
        <span>© 2025 DropNFT. Todos los derechos reservados.</span>
        <span>Operación en red y pagos sujetos al contrato desplegado.</span>
    </div>
</footer>

<script>
let currentAccount = null;
let queue = [];

// Banner
function showBanner(text, type="success") {
    const banner = document.getElementById("banner");
    banner.className = "px-4 py-3 text-white text-sm font-medium";
    if (type==="success") banner.classList.add("bg-green-600");
    if (type==="error")   banner.classList.add("bg-red-600");
    if (type==="info")    banner.classList.add("bg-blue-600");
    banner.textContent = text;
    banner.classList.remove("hidden");
    setTimeout(()=>banner.classList.add("hidden"), 3500);
}

// Conectar wallet
document.getElementById("btnConnect").addEventListener("click", async () => {
    if (window.ethereum) {
        try {
            await window.ethereum.request({ method: "eth_requestAccounts" });
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            currentAccount = await signer.getAddress();
            showBanner("Wallet conectada.", "success");
        } catch (e) {
            showBanner("No se pudo conectar la wallet.", "error");
        }
    } else {
        currentAccount = "0xLOCAL_" + Math.random().toString(16).slice(2, 6);
        showBanner("No se detectó wallet. Operando en modo local.", "info");
    }
});

// Mostrar sección de venta
document.getElementById("btnVender").addEventListener("click", () => {
    document.getElementById("sectionPrincipal").classList.add("hidden");
    document.getElementById("sectionCargar").classList.remove("hidden");
});

// Publicar imagen
document.getElementById("btnPublicar").addEventListener("click", () => {
    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files?.[0];
    if (!file) {
        showBanner("Subí un JPG válido.", "error");
        return;
    }
    const reader = new FileReader();
    reader.onload = () => {
        const img = new Image();
        img.onload = () => {
            if (img.width > 1000 || img.height > 1000) {
                showBanner("La imagen no puede superar 1000×1000 píxeles.", "error");
                return;
            }
            // Agregar al final de la cola
            queue.push({ dataUrl: reader.result });
            updatePrincipal();
            showBanner("Imagen publicada correctamente.", "success");
            // Volver a card principal
            document.getElementById("sectionCargar").classList.add("hidden");
            document.getElementById("sectionPrincipal").classList.remove("hidden");
            fileInput.value = "";
        };
        img.src = reader.result;
    };
    reader.readAsDataURL(file);
});

// Comprar pixel
document.getElementById("btnComprar").addEventListener("click", () => {
    if (!queue.length) {
        showBanner("No hay imágenes para comprar.", "error");
        return;
    }
    alert("NFT agregado a tu wallet (simulado).");
});

// Actualizar imagen destacada y miniaturas
function updatePrincipal() {
    const featuredWrap = document.getElementById("featuredWrap");
    const listaCola = document.getElementById("listaCola");

    if (queue.length) {
        featuredWrap.innerHTML = '';
        const img = document.createElement("img");
        img.src = queue[0].dataUrl;
        img.className = "w-full h-full object-contain";
        featuredWrap.appendChild(img);
    } else {
        featuredWrap.innerHTML = '<span class="text-sm text-gray-400">Sin imágenes</span>';
    }

    listaCola.innerHTML = '';
    queue.slice(1).forEach(item => {
        const img = document.createElement("img");
        img.src = item.dataUrl;
        img.className = "w-12 h-12 object-cover rounded border border-gray-200";
        listaCola.appendChild(img);
    });
}
</script>

</body>
</html>
